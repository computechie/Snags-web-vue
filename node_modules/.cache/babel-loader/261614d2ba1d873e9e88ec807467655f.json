{"ast":null,"code":"import InputText from 'primevue/inputtext';\nimport Button from 'primevue/button';\nimport InlineMessage from 'primevue/inlinemessage';\nimport Dialog from 'primevue/dialog';\nimport axios from \"axios\";\nimport jssha256 from \"js-sha256\";\nexport default {\n  props: [\"resetKey\"],\n  components: {\n    // DataTable,\n    // Column,\n    InputText,\n    //Checkbox,\n    Button,\n    Dialog,\n    InlineMessage //  Calendar,\n    //InputNumber,\n    //TabView,\n    //TabPanel,\n    //   Dropdown\n\n  },\n\n  data() {\n    return {\n      isLoading: false,\n      displayInfoDialog: false,\n      newPasswordOK: true,\n      newPasswordRepeatOK: true,\n      passwordsMatchOK: true,\n      newPassword: '',\n      newPasswordRepeat: '',\n      passwordChangedOk: false\n    };\n  },\n\n  methods: {\n    typing() {\n      this.newPasswordOK = true;\n      this.newPasswordRepeatOK = true;\n      this.passwordsMatchOK = true;\n    },\n\n    messageClose() {\n      this.displayInfoDialog = false;\n\n      if (this.passwordChangedOk) {\n        this.$router.replace(\"/\");\n      }\n    },\n\n    changePassword() {\n      var AllOk = true;\n\n      if (this.newPassword == '') {\n        this.newPasswordOK = false;\n        AllOk = false;\n      } else {\n        this.newPasswordOK = true;\n      }\n\n      if (this.newPasswordRepeat == '') {\n        this.newPasswordRepeatOK = false;\n        AllOk = false;\n      } else {\n        this.newPasswordRepeatOK = true;\n      }\n\n      if (this.newPassword != '' && this.newPasswordRepeat != '') {\n        if (this.newPassword != this.newPasswordRepeat) {\n          this.passwordsMatchOK = false;\n          AllOk = false;\n        }\n      }\n\n      if (AllOk == true) {\n        if (this.checkPasswordSecurity(this.newPassword)) {\n          this.changePasswordinDatabase();\n        }\n      }\n    },\n\n    checkPasswordSecurity(password) {\n      // at leats 8 chars long, one Uppercase letter, one Lowercase letter, one Number, one Special chars:\n\n      /*    if (password.search(/^(?=.\\d)(?=.[a-z])(?=.[A-Z])(?=.[^a-zA-Z0-9])(?!.*\\s).{8,15}$/) != -1) {\r\n                   alert(\"bad_char\");\r\n               return false;\r\n           }else{\r\n              alert(\"ok\");\r\n              return false;\r\n           }*/\n      var pattern = /^.*(?=.{8,20})(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%&!-_]).*$/;\n\n      if (!pattern.test(password)) {\n        alert(\"not ok\");\n      } else {\n        alert(\"ok\");\n      }\n    },\n\n    async changePasswordinDatabase() {\n      this.isLoading = true;\n      var encodedPassword = jssha256(this.newPassword); // sha256\n      // const sessionId='';\n\n      const baseUrl = localStorage.getItem(\"_rootRestUrl\");\n      let formData = JSON.stringify({\n        \"code\": this.resetKey,\n        \"password\": encodedPassword\n      });\n      let config = {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      await axios.post(baseUrl + \"/api/v1/User/ResetPassword/\", formData, config).then(() => {\n        this.InfoModalHeader = 'Info';\n        this.InfoModalMessage = 'Password is changed. You can now login to app using your new password';\n        this.infoDialogStyle = [{\n          width: '40rem'\n        }];\n        this.displayInfoDialog = true;\n        this.passwordChangedOk = true;\n        this.isLoading = false;\n      }).catch(error => {\n        console.table(error);\n\n        if (error.response) {\n          this.InfoModalHeader = 'Error!';\n          this.InfoModalMessage = error.response.data;\n          this.infoDialogStyle = [{\n            width: '40rem'\n          }];\n          this.displayInfoDialog = true;\n        }\n\n        this.isLoading = false;\n      });\n    }\n\n  },\n\n  mounted() {}\n\n};","map":{"version":3,"mappings":"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","names":["InputText","Button","InlineMessage","Dialog","axios","jssha256","props","components","data","isLoading","displayInfoDialog","newPasswordOK","newPasswordRepeatOK","passwordsMatchOK","newPassword","newPasswordRepeat","passwordChangedOk","methods","typing","messageClose","$router","replace","changePassword","AllOk","checkPasswordSecurity","changePasswordinDatabase","password","pattern","test","alert","encodedPassword","baseUrl","localStorage","getItem","formData","JSON","stringify","resetKey","config","headers","post","then","InfoModalHeader","InfoModalMessage","infoDialogStyle","width","catch","error","console","table","response","mounted"],"sourceRoot":"","sources":["Q:\\Projects\\Transport-web-\\src\\components\\pages\\ResetPassword.vue"],"sourcesContent":["<template>\r\n\r\n<base-dialog :show=\"isLoading\"  title=\"Authenticating...\" fixed>\r\n    <base-spinner></base-spinner>\r\n  </base-dialog>\r\n\r\n<top-bar\r\n    @emitSearch=\"emitedSearch\"\r\n    v-bind:show-search=\"showSearch\"\r\n    v-bind:menu-icon=\"iconCloseOpen2\"\r\n    background-style=\"rgb(255,255,255,0.6)\"\r\n    title-color=\"black\"\r\n    v-bind:title-text=\"MainTitleText\"\r\n  ></top-bar>\r\n\r\n<div class=\"container\">\r\n\r\n    <div class=\"row\">\r\n        <div class=\"col-md-12 text-center gap-2 gaptop-2\">\r\n            <h4>Reset password</h4>\r\n        </div>\r\n      \r\n        <div class=\"col-md-12 text-center gap-2\">\r\n           \r\n            \r\n                <div class=\"flex flex-column gap-2\"> \r\n                    <label for=\"password\">Enter new password</label>\r\n                    <InputText type=\"password\" @input=\"typing\" v-model=\"newPassword\" style=\"min-width:300px\"/>\r\n\r\n                 <p> <InlineMessage v-if=\"!newPasswordOK\">This field is required</InlineMessage>\r\n                    <InlineMessage v-if=\"!passwordsMatchOK\">Passwords do NOT match!</InlineMessage></p>\r\n              </div>\r\n                \r\n           \r\n        </div>\r\n\r\n        <div class=\"col-md-12 text-center gap-2\">\r\n           \r\n                <div class=\"flex flex-column gap-2\"> \r\n                    <label for=\"password\">Repeat password</label>\r\n                    <InputText type=\"password\" @input=\"typing\" v-model=\"newPasswordRepeat\" style=\"min-width:300px\"/>\r\n\r\n                <p> <InlineMessage v-if=\"!newPasswordRepeatOK\">This field is required</InlineMessage>\r\n                    <InlineMessage v-if=\"!passwordsMatchOK\">Passwords do NOT match!</InlineMessage></p>\r\n                </div>\r\n           \r\n        </div>\r\n        <div class=\"col-md-12 text-center gap-2\">\r\n            <p><Button label=\"Set new password\" @click=\"changePassword\"/></p>\r\n        </div>\r\n\r\n        <div class=\"col-md-12 text-center gap-2\">\r\n            <p><a href=\"/\">back to home page</a></p>\r\n        </div>\r\n\r\n    </div>\r\n\r\n</div>\r\n\r\n <!-- dialog info --> \r\n <Dialog v-model:visible=\"displayInfoDialog\" modal  :style=\"infoDialogStyle\" :breakpoints=\"{ '1199px': '75vw', '575px': '90vw' }\">\r\n    <template #header=\"\"> \r\n        <h4> {{ InfoModalHeader }}</h4>\r\n    </template>\r\n  \r\n            <span class=\"font-bold text-2xl block mb-2 mt-4\"></span>\r\n            <p class=\"mb-0\">{{InfoModalMessage }}</p>\r\n            <div class=\"flex text-end gap-2 mt-4\">\r\n                <Button label=\"Ok\" @click=\"messageClose\"></Button>\r\n              \r\n            </div>          \r\n</Dialog>\r\n\r\n\r\n</template>\r\n\r\n<script>\r\nimport InputText from 'primevue/inputtext';\r\nimport Button from 'primevue/button';\r\nimport InlineMessage from 'primevue/inlinemessage';\r\nimport Dialog from 'primevue/dialog';\r\n\r\nimport axios from \"axios\";\r\n\r\nimport jssha256 from \"js-sha256\";\r\n\r\nexport default {\r\n    props: [\"resetKey\"],\r\n    components: {\r\n       // DataTable,\r\n       // Column,\r\n        InputText,\r\n        //Checkbox,\r\n        Button,\r\n        Dialog,\r\n        InlineMessage,\r\n      //  Calendar,\r\n        //InputNumber,\r\n        //TabView,\r\n        //TabPanel,\r\n     //   Dropdown\r\n        \r\n    },\r\n\r\n  \r\n  data() {\r\n        return {\r\n            isLoading:false,\r\n            displayInfoDialog:false,\r\n            newPasswordOK:true,\r\n            newPasswordRepeatOK:true,\r\n            passwordsMatchOK:true,\r\n            newPassword:'',\r\n            newPasswordRepeat:'',    \r\n            passwordChangedOk:false,     \r\n        }\r\n\r\n         \r\n    },\r\n\r\n   methods:{\r\n            typing(){\r\n               this.newPasswordOK=true;\r\n               this.newPasswordRepeatOK=true;\r\n               this.passwordsMatchOK=true;\r\n\r\n            },\r\n            messageClose(){\r\n                this.displayInfoDialog=false;\r\n                if(this.passwordChangedOk){\r\n                    this.$router.replace(\"/\");\r\n                }    \r\n            },\r\n  \r\n        changePassword(){\r\n\r\n            var AllOk = true;\r\n\r\n            if(this.newPassword == ''){\r\n            this.newPasswordOK = false;\r\n            AllOk = false;\r\n            }else{this.newPasswordOK = true;}\r\n\r\n            if(this.newPasswordRepeat == ''){\r\n            this.newPasswordRepeatOK = false;\r\n            AllOk = false;\r\n            }else{this.newPasswordRepeatOK = true;}\r\n\r\n\r\n            if(this.newPassword != '' &&  this.newPasswordRepeat != ''){\r\n                    if(this.newPassword != this.newPasswordRepeat){\r\n                            this.passwordsMatchOK=false;\r\n                    AllOk = false;\r\n                    }\r\n                }\r\n\r\n           if( AllOk == true){\r\n                if(this.checkPasswordSecurity(this.newPassword)){\r\n                    this.changePasswordinDatabase();\r\n                }\r\n           }\r\n\r\n        },\r\n\r\n          checkPasswordSecurity(password){\r\n\r\n                // at leats 8 chars long, one Uppercase letter, one Lowercase letter, one Number, one Special chars:\r\n             \r\n            /*    if (password.search(/^(?=.\\d)(?=.[a-z])(?=.[A-Z])(?=.[^a-zA-Z0-9])(?!.*\\s).{8,15}$/) != -1) {\r\n                         alert(\"bad_char\");\r\n                     return false;\r\n                 }else{\r\n                    alert(\"ok\");\r\n                    return false;\r\n                 }*/\r\n\r\n                 var pattern =/^.*(?=.{8,20})(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%&!-_]).*$/;\r\n                 if(!pattern.test(password)) {\r\n                          alert(\"not ok\")\r\n                 }else {\r\n                          alert(\"ok\");\r\n                 }    \r\n   \r\n        },\r\n\r\n\r\n\r\n      async   changePasswordinDatabase(){\r\n       \r\n         this.isLoading = true;\r\n           \r\n        var encodedPassword = jssha256(this.newPassword);  // sha256\r\n           \r\n        \r\n           // const sessionId='';\r\n            const baseUrl = localStorage.getItem(\"_rootRestUrl\");\r\n           \r\n            let formData = JSON.stringify({\"code\": this.resetKey,\"password\":encodedPassword});\r\n       \r\n            let config = {\r\n              headers: {\r\n                \"Content-Type\": \"application/json\",\r\n            }};\r\n  \r\n            \r\n            await axios\r\n              .post(baseUrl + \"/api/v1/User/ResetPassword/\",formData, config )\r\n              .then(() => {\r\n                             \r\n                                       \r\n                 \r\n                this.InfoModalHeader='Info';\r\n                this.InfoModalMessage='Password is changed. You can now login to app using your new password';\r\n                this.infoDialogStyle=[{ width: '40rem' }];\r\n                this.displayInfoDialog= true;\r\n                this.passwordChangedOk=true;        \r\n                this.isLoading = false; \r\n            })\r\n              \r\n              .catch((error) => {\r\n            \r\n               console.table(error)\r\n                    if(error.response){\r\n                        this.InfoModalHeader='Error!';\r\n                        this.InfoModalMessage=error.response.data;\r\n                        this.infoDialogStyle=[{ width: '40rem' }];\r\n                        this.displayInfoDialog= true;\r\n                    \r\n                    }   \r\n                   \r\n                    this.isLoading = false;   \r\n                   \r\n             });\r\n\r\n\r\n        }\r\n\r\n   },\r\n\r\n    mounted(){\r\n       \r\n    }\r\n}\r\n\r\n\r\n</script>\r\n\r\n<style>\r\n@import \"datatables.net-dt\";\r\n@import \"primevue/resources/themes/bootstrap4-light-blue/theme.css\"; /*theme*/\r\n@import \"primevue/resources/primevue.min.css   \"; /*core css*/\r\n@import \"primeicons/primeicons.css   \"; /*icons*/\r\n\r\nlabel{display:block;font-size:14px}\r\n.gap-2{margin-bottom:1rem}\r\n.gaptop-2{margin-top:1rem}\r\n\r\n.p-dialog{max-height: 220px}\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}