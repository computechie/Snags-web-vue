{"ast":null,"code":"/**\n * Detect double tap events\n * # Deals with:\n * - Time intervals between taps\n * - Swipe will stop the taps\n * # Usage:\n * let tapDetector = new TapDetector()\n * tapDetector.attach(this.$el) // in mounted\n * tapDetector.detach(this.$el) // in destroy\n * tapDetector.onSingle(callback)\n * tapDetector.onDouble(callback)\n */\nfunction TapDetector() {\n  // Callbacks -----------------------------------------------------------------\n  let singleTapCallbacks = [];\n  let doubleTapCallbacks = [];\n\n  function triggerCallbacks(cbList, arg) {\n    cbList.forEach(cbItem => {\n      cbItem.call(null, arg);\n    });\n  }\n\n  this.onSingleTap = function (cb) {\n    if (typeof cb === 'function' && !singleTapCallbacks.includes(cb)) {\n      singleTapCallbacks.push(cb);\n    }\n  };\n\n  this.onDoubleTap = function (cb) {\n    if (typeof cb === 'function' && !doubleTapCallbacks.includes(cb)) {\n      doubleTapCallbacks.push(cb);\n    }\n  };\n\n  this.attach = function (dom) {\n    if (!(dom instanceof Element)) {\n      console.error('TapDetector.attach: arg must be an Element');\n      return;\n    }\n\n    dom.addEventListener('touchstart', onTouchStart);\n    dom.addEventListener('touchmove', onTouchMove);\n    dom.addEventListener('touchend', onTouchEnd);\n    dom.addEventListener('mousedown', onMouseDown);\n    dom.addEventListener('mouseup', onMouseUp);\n    dom.addEventListener('mousemove', onMouseMove);\n  };\n\n  this.detach = function (dom) {\n    dom.removeEventListener('touchstart', onTouchStart);\n    dom.removeEventListener('touchmove', onTouchMove);\n    dom.removeEventListener('touchend', onTouchEnd);\n    dom.removeEventListener('mousedown', onMouseDown);\n    dom.removeEventListener('mouseup', onMouseUp);\n    dom.removeEventListener('mousemove', onMouseMove);\n  }; // Main logic ----------------------------------------------------------------\n  // in touch mode mouse events will be disabled. Otherwise touches will\n  // trigger both touchend end mouseup, i.e. one touch triggers two onPointerUp.\n\n\n  let isTouchMode = false;\n  let lastTapTimestamp = 0;\n  let tappedCount = 0;\n  let touchMovedLength = 0;\n  let lastPointerX = 0;\n  let lastPointerY = 0;\n\n  function onTouchStart(ev) {\n    isTouchMode = true; // console.log('onTouchStart')\n\n    if (ev.touches.length === 1) {\n      onPointerDown(ev.touches[0].clientX, ev.touches[0].clientY);\n    }\n  }\n\n  function onTouchEnd(ev) {\n    // console.log('onTouchEnd')\n    if (ev.touches.length === 0) {\n      onPointerUp();\n    }\n  }\n\n  function onTouchMove(ev) {\n    // console.log('onTouchMove', ev)\n    if (ev.touches.length === 1) {\n      onPointerMove(ev.touches[0].clientX, ev.touches[0].clientY);\n    }\n  }\n\n  function onMouseDown(ev) {\n    if (isTouchMode) return; // console.log('onMouseDown')\n\n    onPointerDown(ev.clientX, ev.clientY);\n  }\n\n  function onMouseUp(ev) {\n    if (isTouchMode) return; // console.log('onMouseUp')\n\n    onPointerUp();\n  }\n\n  function onMouseMove(ev) {\n    if (isTouchMode) return; // console.log('onMouseMove', ev)\n\n    if (ev.button === 0) {\n      onPointerMove(ev.clientX, ev.clientY);\n    }\n  }\n\n  function onPointerDown(x, y) {\n    lastPointerX = x;\n    lastPointerY = y;\n    touchMovedLength = 0;\n  }\n\n  function onPointerUp() {\n    let currTimeStamp = Date.now(); // console.log('touchMovedLength', touchMovedLength)\n\n    if (touchMovedLength < 10) {\n      // Only when no sliding two far is considered as a valid tap\n      if (currTimeStamp - lastTapTimestamp < 300) {\n        tappedCount += 1;\n      } else {\n        tappedCount = 1;\n      }\n\n      lastTapTimestamp = Date.now(); // console.log('tappedCount', tappedCount)\n\n      triggerCallbacks(singleTapCallbacks, {\n        clientX: lastPointerX,\n        clientY: lastPointerY\n      });\n\n      if (tappedCount === 2) {\n        triggerCallbacks(doubleTapCallbacks, {\n          clientX: lastPointerX,\n          clientY: lastPointerY\n        });\n        tappedCount = 0; // clear count on maximum tap count\n      }\n    }\n\n    touchMovedLength = 0;\n  }\n\n  function onPointerMove(x, y) {\n    let deltaX = lastPointerX - x;\n    let deltaY = lastPointerY - y;\n    let length = Math.sqrt(deltaX * deltaX + deltaY * deltaY); // console.log('onTouchMove length', length)\n\n    touchMovedLength += length;\n    lastPointerX = x;\n    lastPointerY = y;\n  }\n}\n\nexport default TapDetector;","map":{"version":3,"names":["TapDetector","singleTapCallbacks","doubleTapCallbacks","triggerCallbacks","cbList","arg","forEach","cbItem","call","onSingleTap","cb","includes","push","onDoubleTap","attach","dom","Element","console","error","addEventListener","onTouchStart","onTouchMove","onTouchEnd","onMouseDown","onMouseUp","onMouseMove","detach","removeEventListener","isTouchMode","lastTapTimestamp","tappedCount","touchMovedLength","lastPointerX","lastPointerY","ev","touches","length","onPointerDown","clientX","clientY","onPointerUp","onPointerMove","button","x","y","currTimeStamp","Date","now","deltaX","deltaY","Math","sqrt"],"sources":["Q:/Projects/Transport-web/node_modules/vue-zoomer/src/TapDetector.js"],"sourcesContent":["/**\n * Detect double tap events\n * # Deals with:\n * - Time intervals between taps\n * - Swipe will stop the taps\n * # Usage:\n * let tapDetector = new TapDetector()\n * tapDetector.attach(this.$el) // in mounted\n * tapDetector.detach(this.$el) // in destroy\n * tapDetector.onSingle(callback)\n * tapDetector.onDouble(callback)\n */\n\nfunction TapDetector () {\n\n  // Callbacks -----------------------------------------------------------------\n\n  let singleTapCallbacks = []\n  let doubleTapCallbacks = []\n\n  function triggerCallbacks (cbList, arg) {\n    cbList.forEach(cbItem => {\n      cbItem.call(null, arg)\n    })\n  }\n\n  this.onSingleTap = function (cb) {\n    if (typeof cb === 'function' && !singleTapCallbacks.includes(cb)) {\n      singleTapCallbacks.push(cb)\n    }\n  }\n  this.onDoubleTap = function (cb) {\n    if (typeof cb === 'function' && !doubleTapCallbacks.includes(cb)) {\n      doubleTapCallbacks.push(cb)\n    }\n  }\n\n  this.attach = function (dom) {\n    if (!(dom instanceof Element)) {\n      console.error('TapDetector.attach: arg must be an Element')\n      return\n    }\n    dom.addEventListener('touchstart', onTouchStart)\n    dom.addEventListener('touchmove', onTouchMove)\n    dom.addEventListener('touchend', onTouchEnd)\n    dom.addEventListener('mousedown', onMouseDown)\n    dom.addEventListener('mouseup', onMouseUp)\n    dom.addEventListener('mousemove', onMouseMove)\n  }\n\n  this.detach = function (dom) {\n    dom.removeEventListener('touchstart', onTouchStart)\n    dom.removeEventListener('touchmove', onTouchMove)\n    dom.removeEventListener('touchend', onTouchEnd)\n    dom.removeEventListener('mousedown', onMouseDown)\n    dom.removeEventListener('mouseup', onMouseUp)\n    dom.removeEventListener('mousemove', onMouseMove)\n  }\n\n  // Main logic ----------------------------------------------------------------\n\n  // in touch mode mouse events will be disabled. Otherwise touches will\n  // trigger both touchend end mouseup, i.e. one touch triggers two onPointerUp.\n  let isTouchMode = false\n  let lastTapTimestamp = 0\n  let tappedCount = 0\n  let touchMovedLength = 0\n  let lastPointerX = 0\n  let lastPointerY = 0\n\n  function onTouchStart (ev) {\n    isTouchMode = true\n    // console.log('onTouchStart')\n    if (ev.touches.length === 1) {\n      onPointerDown(ev.touches[0].clientX, ev.touches[0].clientY)\n    }\n  }\n  function onTouchEnd (ev) {\n    // console.log('onTouchEnd')\n    if (ev.touches.length === 0) {\n      onPointerUp()\n    }\n  }\n  function onTouchMove (ev) {\n    // console.log('onTouchMove', ev)\n    if (ev.touches.length === 1) {\n      onPointerMove(ev.touches[0].clientX, ev.touches[0].clientY)\n    }\n  }\n\n  function onMouseDown (ev) {\n    if (isTouchMode) return\n\n    // console.log('onMouseDown')\n    onPointerDown(ev.clientX, ev.clientY)\n  }\n  function onMouseUp (ev) {\n    if (isTouchMode) return\n\n    // console.log('onMouseUp')\n    onPointerUp()\n  }\n  function onMouseMove (ev) {\n    if (isTouchMode) return\n\n    // console.log('onMouseMove', ev)\n    if (ev.button === 0) {\n      onPointerMove(ev.clientX, ev.clientY)\n    }\n  }\n\n  function onPointerDown (x, y) {\n    lastPointerX = x\n    lastPointerY = y\n    touchMovedLength = 0\n  }\n  function onPointerUp () {\n    let currTimeStamp = Date.now()\n    // console.log('touchMovedLength', touchMovedLength)\n    if (touchMovedLength < 10) {\n      // Only when no sliding two far is considered as a valid tap\n      if (currTimeStamp - lastTapTimestamp < 300) {\n        tappedCount += 1\n      } else {\n        tappedCount = 1\n      }\n      lastTapTimestamp = Date.now()\n      // console.log('tappedCount', tappedCount)\n      triggerCallbacks(singleTapCallbacks, {\n        clientX: lastPointerX,\n        clientY: lastPointerY,\n      })\n      if (tappedCount === 2) {\n        triggerCallbacks(doubleTapCallbacks, {\n          clientX: lastPointerX,\n          clientY: lastPointerY,\n        })\n        tappedCount = 0 // clear count on maximum tap count\n      }\n    }\n    touchMovedLength = 0\n  }\n  function onPointerMove (x, y) {\n    let deltaX = lastPointerX - x\n    let deltaY = lastPointerY - y\n    let length = Math.sqrt(deltaX * deltaX + deltaY * deltaY)\n    // console.log('onTouchMove length', length)\n    touchMovedLength += length\n    lastPointerX = x\n    lastPointerY = y\n  }\n}\n\nexport default TapDetector\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}