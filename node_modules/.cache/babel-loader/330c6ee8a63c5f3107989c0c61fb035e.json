{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nlet timer; // for holding timer function for auto logout if session expire\n\nexport default {\n  async login(context, payload) {\n    return context.dispatch(\"auth\", { ...payload\n    });\n  },\n\n  async auth(context, payload) {\n    //const token = context.rootGetters.token; //User token !!\n    const baseUrl = localStorage.getItem(\"_rootRestUrl\");\n    const response = await fetch(baseUrl + \"/Authenthication/Login\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        username: payload.username,\n        password: payload.password\n      })\n    });\n\n    if (response.status == 404) {\n      alert(\"Wrong username or password!\");\n    }\n\n    const responseData = await response.json();\n\n    if (response.status != 200) {\n      // console.log(responseData);\n      const error = new Error(responseData.message || \"Failed to authenticate.\");\n      throw error;\n    } //expecting in json recive 'exipresIn' in minutes! how long will session exists\n\n\n    const expiresIn = responseData.validFor * 1000 * 60; //auto logout if token expires\n\n    timer = setTimeout(function () {\n      context.dispatch(\"autoLogout\");\n    }, expiresIn); //store login details in local storeage so that on refresh page app remember loged user!\n\n    localStorage.setItem(\"token\", responseData.key);\n    localStorage.setItem(\"userId\", responseData.userId);\n    localStorage.setItem(\"tokenExpiration\", responseData.validUntil); //data needed from login json:\n    //localStorage.setItem('userFullname',payload.username);\n\n    localStorage.setItem(\"expiresIn\", expiresIn);\n    context.commit(\"setUser\", {\n      token: responseData.key,\n      userId: responseData.userId,\n      userFullname: \"Full name\"\n    });\n  },\n\n  logout(context) {\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"userId\");\n    localStorage.removeItem(\"userFullname\");\n    localStorage.removeItem(\"tokenExpiration\");\n    localStorage.removeItem(\"expiresIn\");\n    clearTimeout(timer);\n    context.commit(\"setUser\", {\n      token: null,\n      userId: null,\n      userFullname: null,\n      tokenExpiration: null\n    });\n  },\n\n  //try to login if local storage containt login details\n  autoLogin(context) {\n    const token = localStorage.getItem(\"token\");\n    const userId = localStorage.getItem(\"userId\");\n    const userFullname = localStorage.getItem(\"userFullname\");\n    const tokenExpiration = localStorage.getItem(\"tokenExpiration\");\n    const willExpire = +tokenExpiration - new Date().getTime();\n    const expiresIn = localStorage.getItem(\"expiresIn\");\n\n    if (willExpire < 0) {\n      //if token expires do nothing\n      return;\n    } //if is token ok then we must extend life of the token for the next expiration time\n\n\n    const expirationDate = new Date().getTime() + expiresIn;\n    localStorage.setItem(\"tokenExpiration\", expirationDate); //set new timer\n\n    timer = setTimeout(function () {\n      context.dispatch(\"autoLogout\");\n    }, expiresIn); //login \"again\" this user\n\n    if (token && userId && userFullname) {\n      context.commit(\"setUser\", {\n        token: token,\n        userId: userId,\n        userFullname: userFullname\n      });\n    }\n  },\n\n  autoLogout(context) {\n    context.dispatch(\"logout\");\n    context.commit(\"setAutoLogout\");\n  }\n\n};","map":{"version":3,"names":["timer","login","context","payload","dispatch","auth","baseUrl","localStorage","getItem","response","fetch","method","headers","body","JSON","stringify","username","password","status","alert","responseData","json","error","Error","message","expiresIn","validFor","setTimeout","setItem","key","userId","validUntil","commit","token","userFullname","logout","removeItem","clearTimeout","tokenExpiration","autoLogin","willExpire","Date","getTime","expirationDate","autoLogout"],"sources":["Q:/Projects/DFM v2/src/store/modules/auth/actions.js"],"sourcesContent":["let timer; // for holding timer function for auto logout if session expire\r\n\r\n\r\n\r\nexport default {\r\n  async login(context, payload) {\r\n    return context.dispatch(\"auth\", {\r\n      ...payload,\r\n    });\r\n  },\r\n\r\n  async auth(context, payload) {\r\n    //const token = context.rootGetters.token; //User token !!\r\n\r\n    const baseUrl = localStorage.getItem(\"_rootRestUrl\");\r\n    const response = await fetch(baseUrl+\"/Authenthication/Login\", {\r\n      method: \"POST\",\r\n\r\n      headers: {\r\n        \"Content-Type\":\"application/json\"\r\n      },\r\n      body: JSON.stringify({\r\n        username: payload.username,\r\n        password: payload.password,\r\n      }),\r\n    });\r\n\r\n    if (response.status==404) {  \r\n       \r\n        alert(\"Wrong username or password!\")\r\n    }\r\n\r\n    const responseData = await response.json();\r\n\r\n    if (response.status!=200) {\r\n      // console.log(responseData);\r\n      const error = new Error(\r\n        responseData.message || \"Failed to authenticate.\"\r\n      );\r\n      throw error;\r\n    }\r\n\r\n    \r\n\r\n\r\n    //expecting in json recive 'exipresIn' in minutes! how long will session exists\r\n    const expiresIn = responseData.validFor * 1000 * 60;\r\n\r\n    //auto logout if token expires\r\n    timer = setTimeout(function () {\r\n      context.dispatch(\"autoLogout\");\r\n    }, expiresIn);\r\n\r\n    //store login details in local storeage so that on refresh page app remember loged user!\r\n\r\n    localStorage.setItem(\"token\", responseData.key);\r\n    localStorage.setItem(\"userId\", responseData.userId);\r\n    localStorage.setItem(\"tokenExpiration\", responseData.validUntil);\r\n\r\n    //data needed from login json:\r\n\r\n    //localStorage.setItem('userFullname',payload.username);\r\n\r\n    localStorage.setItem(\"expiresIn\", expiresIn);\r\n\r\n    context.commit(\"setUser\", {\r\n      token: responseData.key,\r\n      userId: responseData.userId,\r\n      userFullname: \"Full name\",\r\n    });\r\n  },\r\n\r\n  logout(context) {\r\n    localStorage.removeItem(\"token\");\r\n    localStorage.removeItem(\"userId\");\r\n    localStorage.removeItem(\"userFullname\");\r\n    localStorage.removeItem(\"tokenExpiration\");\r\n    localStorage.removeItem(\"expiresIn\");\r\n\r\n    clearTimeout(timer);\r\n\r\n    context.commit(\"setUser\", {\r\n      token: null,\r\n      userId: null,\r\n      userFullname: null,\r\n      tokenExpiration: null,\r\n    });\r\n  },\r\n\r\n  //try to login if local storage containt login details\r\n  autoLogin(context) {\r\n    const token = localStorage.getItem(\"token\");\r\n    const userId = localStorage.getItem(\"userId\");\r\n    const userFullname = localStorage.getItem(\"userFullname\");\r\n    const tokenExpiration = localStorage.getItem(\"tokenExpiration\");\r\n    const willExpire = +tokenExpiration - new Date().getTime();\r\n    const expiresIn = localStorage.getItem(\"expiresIn\");\r\n\r\n    if (willExpire < 0) {\r\n      //if token expires do nothing\r\n      return;\r\n    }\r\n\r\n    //if is token ok then we must extend life of the token for the next expiration time\r\n\r\n    const expirationDate = new Date().getTime() + expiresIn;\r\n    localStorage.setItem(\"tokenExpiration\", expirationDate);\r\n\r\n    //set new timer\r\n    timer = setTimeout(function () {\r\n      context.dispatch(\"autoLogout\");\r\n    }, expiresIn);\r\n\r\n    //login \"again\" this user\r\n    if (token && userId && userFullname) {\r\n      context.commit(\"setUser\", {\r\n        token: token,\r\n        userId: userId,\r\n        userFullname: userFullname,\r\n      });\r\n    }\r\n  },\r\n  autoLogout(context) {\r\n    context.dispatch(\"logout\");\r\n    context.commit(\"setAutoLogout\");\r\n  },\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}